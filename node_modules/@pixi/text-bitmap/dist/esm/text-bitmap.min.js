/*!
 * @pixi/text-bitmap - v6.0.4
 * Compiled Tue, 11 May 2021 18:00:23 UTC
 *
 * @pixi/text-bitmap is licensed under the MIT License.
 * http://www.opensource.org/licenses/mit-license
 */
import{Rectangle as t,Point as e,ObservablePoint as r}from"@pixi/math";import{settings as i}from"@pixi/settings";import{MeshGeometry as n,MeshMaterial as a,Mesh as s}from"@pixi/mesh";import{hex2rgb as o,string2hex as h,getResolutionOfUrl as f,removeItems as l}from"@pixi/utils";import{BaseTexture as u,Texture as c}from"@pixi/core";import{TEXT_GRADIENT as p,TextStyle as g,TextMetrics as d}from"@pixi/text";import{Container as m}from"@pixi/display";import{LoaderResource as v}from"@pixi/loaders";var x=function(t,e){return(x=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])})(t,e)};var y=function(){return function(){this.info=[],this.common=[],this.page=[],this.char=[],this.kerning=[]}}(),b=function(){function t(){}return t.test=function(t){return"string"==typeof t&&0===t.indexOf("info face=")},t.parse=function(t){var e=t.match(/^[a-z]+\s+.+$/gm),r={info:[],common:[],page:[],char:[],chars:[],kerning:[],kernings:[]};for(var i in e){var n=e[i].match(/^[a-z]+/gm)[0],a=e[i].match(/[a-zA-Z]+=([^\s"']+|"([^"]*)")/gm),s={};for(var o in a){var h=a[o].split("="),f=h[0],l=h[1].replace(/"/gm,""),u=parseFloat(l),c=isNaN(u)?l:u;s[f]=c}r[n].push(s)}var p=new y;return r.info.forEach(function(t){return p.info.push({face:t.face,size:parseInt(t.size,10)})}),r.common.forEach(function(t){return p.common.push({lineHeight:parseInt(t.lineHeight,10)})}),r.page.forEach(function(t){return p.page.push({id:parseInt(t.id,10),file:t.file})}),r.char.forEach(function(t){return p.char.push({id:parseInt(t.id,10),page:parseInt(t.page,10),x:parseInt(t.x,10),y:parseInt(t.y,10),width:parseInt(t.width,10),height:parseInt(t.height,10),xoffset:parseInt(t.xoffset,10),yoffset:parseInt(t.yoffset,10),xadvance:parseInt(t.xadvance,10)})}),r.kerning.forEach(function(t){return p.kerning.push({first:parseInt(t.first,10),second:parseInt(t.second,10),amount:parseInt(t.amount,10)})}),p},t}(),_=function(){function t(){}return t.test=function(t){return t instanceof XMLDocument&&t.getElementsByTagName("page").length&&null!==t.getElementsByTagName("info")[0].getAttribute("face")},t.parse=function(t){for(var e=new y,r=t.getElementsByTagName("info"),i=t.getElementsByTagName("common"),n=t.getElementsByTagName("page"),a=t.getElementsByTagName("char"),s=t.getElementsByTagName("kerning"),o=0;o<r.length;o++)e.info.push({face:r[o].getAttribute("face"),size:parseInt(r[o].getAttribute("size"),10)});for(o=0;o<i.length;o++)e.common.push({lineHeight:parseInt(i[o].getAttribute("lineHeight"),10)});for(o=0;o<n.length;o++)e.page.push({id:parseInt(n[o].getAttribute("id"),10)||0,file:n[o].getAttribute("file")});for(o=0;o<a.length;o++){var h=a[o];e.char.push({id:parseInt(h.getAttribute("id"),10),page:parseInt(h.getAttribute("page"),10)||0,x:parseInt(h.getAttribute("x"),10),y:parseInt(h.getAttribute("y"),10),width:parseInt(h.getAttribute("width"),10),height:parseInt(h.getAttribute("height"),10),xoffset:parseInt(h.getAttribute("xoffset"),10),yoffset:parseInt(h.getAttribute("yoffset"),10),xadvance:parseInt(h.getAttribute("xadvance"),10)})}for(o=0;o<s.length;o++)e.kerning.push({first:parseInt(s[o].getAttribute("first"),10),second:parseInt(s[o].getAttribute("second"),10),amount:parseInt(s[o].getAttribute("amount"),10)});return e},t}(),w=function(){function t(){}return t.test=function(t){if("string"==typeof t&&t.indexOf("<font>")>-1){var e=(new self.DOMParser).parseFromString(t,"text/xml");return _.test(e)}return!1},t.parse=function(t){var e=(new self.DOMParser).parseFromString(t,"text/xml");return _.parse(e)},t}(),A=[b,_,w];function S(t){for(var e=0;e<A.length;e++)if(A[e].test(t))return A[e];return null}function T(t,e,r,i,n,a){var s,o=r.fill;if(!Array.isArray(o))return o;if(1===o.length)return o[0];var h=r.dropShadow?r.dropShadowDistance:0,f=r.padding||0,l=Math.ceil(t.width/i)-h-2*f,u=Math.ceil(t.height/i)-h-2*f,c=o.slice(),g=r.fillGradientStops.slice();if(!g.length)for(var d=c.length+1,m=1;m<d;++m)g.push(m/d);if(c.unshift(o[0]),g.unshift(0),c.push(o[o.length-1]),g.push(1),r.fillGradientType===p.LINEAR_VERTICAL){s=e.createLinearGradient(l/2,f,l/2,u+f);var v=0,x=(a.fontProperties.fontSize+r.strokeThickness)/u;for(m=0;m<n.length;m++)for(var y=a.lineHeight*m,b=0;b<c.length;b++){var _=y/u+("number"==typeof g[b]?g[b]:b/c.length)*x,w=Math.max(v,_);w=Math.min(w,1),s.addColorStop(w,c[b]),v=w}}else{s=e.createLinearGradient(f,u/2,l+f,u/2);var A=c.length+1,S=1;for(m=0;m<c.length;m++){var T=void 0;T="number"==typeof g[m]?g[m]:S/A,s.addColorStop(T,c[m]),S++}}return s}function I(t,e,r,i,n,a,s){var f=r.text,l=r.fontProperties;e.translate(i,n),e.scale(a,a);var u=s.strokeThickness/2,c=-s.strokeThickness/2;e.font=s.toFontString(),e.lineWidth=s.strokeThickness,e.textBaseline=s.textBaseline,e.lineJoin=s.lineJoin,e.miterLimit=s.miterLimit,e.fillStyle=T(t,e,s,a,[f],r),e.strokeStyle=s.stroke,e.font=s.toFontString(),e.lineWidth=s.strokeThickness,e.textBaseline=s.textBaseline,e.lineJoin=s.lineJoin,e.miterLimit=s.miterLimit,e.fillStyle=T(t,e,s,a,[f],r),e.strokeStyle=s.stroke;var p=s.dropShadowColor,g=o("number"==typeof p?p:h(p));s.dropShadow?(e.shadowColor="rgba("+255*g[0]+","+255*g[1]+","+255*g[2]+","+s.dropShadowAlpha+")",e.shadowBlur=s.dropShadowBlur,e.shadowOffsetX=Math.cos(s.dropShadowAngle)*s.dropShadowDistance,e.shadowOffsetY=Math.sin(s.dropShadowAngle)*s.dropShadowDistance):(e.shadowColor="black",e.shadowBlur=0,e.shadowOffsetX=0,e.shadowOffsetY=0),s.stroke&&s.strokeThickness&&e.strokeText(f,u,c+r.lineHeight-l.descent),s.fill&&e.fillText(f,u,c+r.lineHeight-l.descent),e.setTransform(1,0,0,1,0,0),e.fillStyle="rgba(0, 0, 0, 0)"}var O=function(){function e(e,r,i){var n=e.info[0],a=e.common[0],s=e.page[0],o=f(s.file),h={};this._ownsTextures=i,this.font=n.face,this.size=n.size,this.lineHeight=a.lineHeight/o,this.chars={},this.pageTextures=h;for(var l=0;l<e.page.length;l++){var u=e.page[l],p=u.id,g=u.file;h[p]=r instanceof Array?r[l]:r[g]}for(l=0;l<e.char.length;l++){var d=e.char[l],m=(p=d.id,d.page),v=e.char[l],x=v.x,y=v.y,b=v.width,_=v.height,w=v.xoffset,A=v.yoffset,S=v.xadvance;y/=o,b/=o,_/=o,w/=o,A/=o,S/=o;var T=new t((x/=o)+h[m].frame.x/o,y+h[m].frame.y/o,b,_);this.chars[p]={xOffset:w,yOffset:A,xAdvance:S,kerning:{},texture:new c(h[m].baseTexture,T),page:m}}for(l=0;l<e.kerning.length;l++){var I=e.kerning[l],O=I.first,P=I.second,E=I.amount;O/=o,P/=o,E/=o,this.chars[P]&&(this.chars[P].kerning[O]=E)}}return e.prototype.destroy=function(){for(var t in this.chars)this.chars[t].texture.destroy(),this.chars[t].texture=null;for(var t in this.pageTextures)this._ownsTextures&&this.pageTextures[t].destroy(!0),this.pageTextures[t]=null;this.chars=null,this.pageTextures=null},e.install=function(t,r,i){var n;if(t instanceof y)n=t;else{var a=S(t);if(!a)throw new Error("Unrecognized data format for font.");n=a.parse(t)}r instanceof c&&(r=[r]);var s=new e(n,r,i);return e.available[s.font]=s,s},e.uninstall=function(t){var r=e.available[t];if(!r)throw new Error("No font found named '"+t+"'");r.destroy(),delete e.available[t]},e.from=function(t,r,i){if(!t)throw new Error("[BitmapFont] Property `name` is required.");var n=Object.assign({},e.defaultOptions,i),a=n.chars,s=n.padding,o=n.resolution,h=n.textureWidth,f=n.textureHeight,l=function(t){"string"==typeof t&&(t=[t]);for(var e=[],r=0,i=t.length;r<i;r++){var n=t[r];if(Array.isArray(n)){if(2!==n.length)throw new Error("[BitmapFont]: Invalid character range length, expecting 2 got "+n.length+".");var a=n[0].charCodeAt(0),s=n[1].charCodeAt(0);if(s<a)throw new Error("[BitmapFont]: Invalid character range.");for(var o=a,h=s;o<=h;o++)e.push(String.fromCharCode(o))}else e.push.apply(e,n.split(""))}if(0===e.length)throw new Error("[BitmapFont]: Empty set when resolving characters.");return e}(a),p=r instanceof g?r:new g(r),m=h,v=new y;v.info[0]={face:p.fontFamily,size:p.fontSize},v.common[0]={lineHeight:p.fontSize};for(var x,b,_,w=0,A=0,S=0,T=[],O=0;O<l.length;O++){x||((x=document.createElement("canvas")).width=h,x.height=f,b=x.getContext("2d"),_=new u(x,{resolution:o}),T.push(new c(_)),v.page.push({id:T.length-1,file:""}));var P=d.measureText(l[O],p,!1,x),E=P.width,k=Math.ceil(P.height),C=Math.ceil(("italic"===p.fontStyle?2:1)*E);if(A>=f-k*o){if(0===A)throw new Error("[BitmapFont] textureHeight "+f+"px is too small for "+p.fontSize+"px fonts");--O,x=null,b=null,_=null,A=0,w=0,S=0}else if(S=Math.max(k+P.fontProperties.descent,S),C*o+w>=m)--O,A+=S*o,A=Math.ceil(A),w=0,S=0;else{I(x,b,P,w,A,o,p);var M=P.text.charCodeAt(0);v.char.push({id:M,page:T.length-1,x:w/o,y:A/o,width:C,height:k,xoffset:0,yoffset:0,xadvance:Math.ceil(E-(p.dropShadow?p.dropShadowDistance:0)-(p.stroke?p.strokeThickness:0))}),w+=(C+2*s)*o,w=Math.ceil(w)}}O=0;for(var H=l.length;O<H;O++)for(var z=l[O],B=0;B<H;B++){var N=l[B],L=b.measureText(z).width,j=b.measureText(N).width,F=b.measureText(z+N).width-(L+j);F&&v.kerning.push({first:z.charCodeAt(0),second:N.charCodeAt(0),amount:F})}var D=new e(v,T,!0);return void 0!==e.available[t]&&e.uninstall(t),e.available[t]=D,D},e.ALPHA=[["a","z"],["A","Z"]," "],e.NUMERIC=[["0","9"]],e.ALPHANUMERIC=[["a","z"],["A","Z"],["0","9"]," "],e.ASCII=[[" ","~"]],e.defaultOptions={resolution:1,textureWidth:512,textureHeight:512,padding:4,chars:e.ALPHANUMERIC},e.available={},e}(),P=[],E=[],k=function(t){function o(e,n){void 0===n&&(n={});var a=t.call(this)||this;a._tint=16777215;var s=Object.assign({},o.styleDefaults,n),h=s.align,f=s.tint,l=s.maxWidth,u=s.letterSpacing,c=s.fontName,p=s.fontSize;if(!O.available[c])throw new Error('Missing BitmapFont "'+c+'"');return a._activePagesMeshData=[],a._textWidth=0,a._textHeight=0,a._align=h,a._tint=f,a._fontName=c,a._fontSize=p||O.available[c].size,a._text=e,a._maxWidth=l,a._maxLineHeight=0,a._letterSpacing=u,a._anchor=new r(function(){a.dirty=!0},a,0,0),a._roundPixels=i.ROUND_PIXELS,a.dirty=!0,a._textureCache={},a}return function(t,e){function r(){this.constructor=t}x(t,e),t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)}(o,t),o.prototype.updateText=function(){for(var t,r=O.available[this._fontName],i=this._fontSize/r.size,o=new e,h=[],f=[],u=[],p=this._text.replace(/(?:\r\n|\r)/g,"\n")||" ",g=p.length,d=this._maxWidth*r.size/this._fontSize,m=null,v=0,x=0,y=0,b=-1,_=0,w=0,A=0,S=0,T=0;T<g;T++){var I=p.charCodeAt(T),k=p.charAt(T);if(/(?:\s)/.test(k)&&(b=T,_=v,S++),"\r"!==k&&"\n"!==k){var C=r.chars[I];if(C){m&&C.kerning[m]&&(o.x+=C.kerning[m]);var M=E.pop()||{texture:c.EMPTY,line:0,charCode:0,prevSpaces:0,position:new e};M.texture=C.texture,M.line=y,M.charCode=I,M.position.x=o.x+C.xOffset+this._letterSpacing/2,M.position.y=o.y+C.yOffset,M.prevSpaces=S,h.push(M),o.x+=C.xAdvance+this._letterSpacing,v=o.x,A=Math.max(A,C.yOffset+C.texture.height),m=I,-1!==b&&d>0&&o.x>d&&(l(h,1+b-++w,1+T-b),T=b,b=-1,f.push(_),u.push(h.length>0?h[h.length-1].prevSpaces:0),x=Math.max(x,_),y++,o.x=0,o.y+=r.lineHeight,m=null,S=0)}}else f.push(v),u.push(-1),x=Math.max(x,v),++y,++w,o.x=0,o.y+=r.lineHeight,m=null,S=0}var H=p.charAt(p.length-1);"\r"!==H&&"\n"!==H&&(/(?:\s)/.test(H)&&(v=_),f.push(v),x=Math.max(x,v),u.push(-1));var z=[];for(T=0;T<=y;T++){var B=0;"right"===this._align?B=x-f[T]:"center"===this._align?B=(x-f[T])/2:"justify"===this._align&&(B=u[T]<0?0:(x-f[T])/u[T]),z.push(B)}var N=h.length,L={},j=[],F=this._activePagesMeshData;for(T=0;T<F.length;T++)P.push(F[T]);for(T=0;T<N;T++){var D=($=h[T].texture).baseTexture.uid;if(!L[D]){if(!(rt=P.pop())){var W=new n,U=new a(c.EMPTY);rt={index:0,indexCount:0,vertexCount:0,uvsCount:0,total:0,mesh:new s(W,U),vertices:null,uvs:null,indices:null}}rt.index=0,rt.indexCount=0,rt.vertexCount=0,rt.uvsCount=0,rt.total=0;var R=this._textureCache;R[D]=R[D]||new c($.baseTexture),rt.mesh.texture=R[D],rt.mesh.tint=this._tint,j.push(rt),L[D]=rt}L[D].total++}for(T=0;T<F.length;T++)-1===j.indexOf(F[T])&&this.removeChild(F[T].mesh);for(T=0;T<j.length;T++)j[T].mesh.parent!==this&&this.addChild(j[T].mesh);for(var T in this._activePagesMeshData=j,L){var X=(rt=L[T]).total;if(!((null===(t=rt.indices)||void 0===t?void 0:t.length)>6*X)||rt.vertices.length<2*s.BATCHABLE_SIZE)rt.vertices=new Float32Array(8*X),rt.uvs=new Float32Array(8*X),rt.indices=new Uint16Array(6*X);else for(var Y=rt.total,G=rt.vertices,J=4*Y*2;J<G.length;J++)G[J]=0;rt.mesh.size=6*X}for(T=0;T<N;T++){var Z=(k=h[T]).position.x+z[k.line]*("justify"===this._align?k.prevSpaces:1);this._roundPixels&&(Z=Math.round(Z));var $,V=Z*i,q=k.position.y*i,K=L[($=k.texture).baseTexture.uid],Q=$.frame,tt=$._uvs,et=K.index++;K.indices[6*et+0]=0+4*et,K.indices[6*et+1]=1+4*et,K.indices[6*et+2]=2+4*et,K.indices[6*et+3]=0+4*et,K.indices[6*et+4]=2+4*et,K.indices[6*et+5]=3+4*et,K.vertices[8*et+0]=V,K.vertices[8*et+1]=q,K.vertices[8*et+2]=V+Q.width*i,K.vertices[8*et+3]=q,K.vertices[8*et+4]=V+Q.width*i,K.vertices[8*et+5]=q+Q.height*i,K.vertices[8*et+6]=V,K.vertices[8*et+7]=q+Q.height*i,K.uvs[8*et+0]=tt.x0,K.uvs[8*et+1]=tt.y0,K.uvs[8*et+2]=tt.x1,K.uvs[8*et+3]=tt.y1,K.uvs[8*et+4]=tt.x2,K.uvs[8*et+5]=tt.y2,K.uvs[8*et+6]=tt.x3,K.uvs[8*et+7]=tt.y3}for(var T in this._textWidth=x*i,this._textHeight=(o.y+r.lineHeight)*i,L){var rt=L[T];if(0!==this.anchor.x||0!==this.anchor.y)for(var it=0,nt=this._textWidth*this.anchor.x,at=this._textHeight*this.anchor.y,st=0;st<rt.total;st++)rt.vertices[it++]-=nt,rt.vertices[it++]-=at,rt.vertices[it++]-=nt,rt.vertices[it++]-=at,rt.vertices[it++]-=nt,rt.vertices[it++]-=at,rt.vertices[it++]-=nt,rt.vertices[it++]-=at;this._maxLineHeight=A*i;var ot=rt.mesh.geometry.getBuffer("aVertexPosition"),ht=rt.mesh.geometry.getBuffer("aTextureCoord"),ft=rt.mesh.geometry.getIndex();ot.data=rt.vertices,ht.data=rt.uvs,ft.data=rt.indices,ot.update(),ht.update(),ft.update()}for(T=0;T<h.length;T++)E.push(h[T])},o.prototype.updateTransform=function(){this.validate(),this.containerUpdateTransform()},o.prototype.getLocalBounds=function(){return this.validate(),t.prototype.getLocalBounds.call(this)},o.prototype.validate=function(){this.dirty&&(this.updateText(),this.dirty=!1)},Object.defineProperty(o.prototype,"tint",{get:function(){return this._tint},set:function(t){if(this._tint!==t){this._tint=t;for(var e=0;e<this._activePagesMeshData.length;e++)this._activePagesMeshData[e].mesh.tint=t}},enumerable:!1,configurable:!0}),Object.defineProperty(o.prototype,"align",{get:function(){return this._align},set:function(t){this._align!==t&&(this._align=t,this.dirty=!0)},enumerable:!1,configurable:!0}),Object.defineProperty(o.prototype,"fontName",{get:function(){return this._fontName},set:function(t){if(!O.available[t])throw new Error('Missing BitmapFont "'+t+'"');this._fontName!==t&&(this._fontName=t,this.dirty=!0)},enumerable:!1,configurable:!0}),Object.defineProperty(o.prototype,"fontSize",{get:function(){return this._fontSize},set:function(t){this._fontSize!==t&&(this._fontSize=t,this.dirty=!0)},enumerable:!1,configurable:!0}),Object.defineProperty(o.prototype,"anchor",{get:function(){return this._anchor},set:function(t){"number"==typeof t?this._anchor.set(t):this._anchor.copyFrom(t)},enumerable:!1,configurable:!0}),Object.defineProperty(o.prototype,"text",{get:function(){return this._text},set:function(t){t=String(null==t?"":t),this._text!==t&&(this._text=t,this.dirty=!0)},enumerable:!1,configurable:!0}),Object.defineProperty(o.prototype,"maxWidth",{get:function(){return this._maxWidth},set:function(t){this._maxWidth!==t&&(this._maxWidth=t,this.dirty=!0)},enumerable:!1,configurable:!0}),Object.defineProperty(o.prototype,"maxLineHeight",{get:function(){return this.validate(),this._maxLineHeight},enumerable:!1,configurable:!0}),Object.defineProperty(o.prototype,"textWidth",{get:function(){return this.validate(),this._textWidth},enumerable:!1,configurable:!0}),Object.defineProperty(o.prototype,"letterSpacing",{get:function(){return this._letterSpacing},set:function(t){this._letterSpacing!==t&&(this._letterSpacing=t,this.dirty=!0)},enumerable:!1,configurable:!0}),Object.defineProperty(o.prototype,"roundPixels",{get:function(){return this._roundPixels},set:function(t){t!==this._roundPixels&&(this._roundPixels=t,this.dirty=!0)},enumerable:!1,configurable:!0}),Object.defineProperty(o.prototype,"textHeight",{get:function(){return this.validate(),this._textHeight},enumerable:!1,configurable:!0}),o.prototype.destroy=function(e){var r=this._textureCache;for(var i in r){r[i].destroy(),delete r[i]}this._textureCache=null,t.prototype.destroy.call(this,e)},o.styleDefaults={align:"left",tint:16777215,maxWidth:0,letterSpacing:0},o}(m),C=function(){function t(){}return t.add=function(){v.setExtensionXhrType("fnt",v.XHR_RESPONSE_TYPE.TEXT)},t.use=function(e,r){var i=S(e.data);if(i)for(var n=t.getBaseUrl(this,e),a=i.parse(e.data),s={},o=function(t){s[t.metadata.pageFile]=t.texture,Object.keys(s).length===a.page.length&&(e.bitmapFont=O.install(a,s,!0),r())},h=0;h<a.page.length;++h){var f=a.page[h].file,l=n+f,u=!1;for(var c in this.resources){var p=this.resources[c];if(p.url===l){p.metadata.pageFile=f,p.texture?o(p):p.onAfterMiddleware.add(o),u=!0;break}}if(!u){var g={crossOrigin:e.crossOrigin,loadType:v.LOAD_TYPE.IMAGE,metadata:Object.assign({pageFile:f},e.metadata.imageMetadata),parentResource:e};this.add(l,g,o)}}else r()},t.getBaseUrl=function(e,r){var i=r.isDataUrl?"":t.dirname(r.url);return r.isDataUrl&&("."===i&&(i=""),e.baseUrl&&i&&"/"===e.baseUrl.charAt(e.baseUrl.length-1)&&(i+="/")),(i=i.replace(e.baseUrl,""))&&"/"!==i.charAt(i.length-1)&&(i+="/"),i},t.dirname=function(t){var e=t.replace(/\\/g,"/").replace(/\/$/,"").replace(/\/[^\/]*$/,"");return e===t?".":""===e?"/":e},t}();export{O as BitmapFont,y as BitmapFontData,C as BitmapFontLoader,k as BitmapText};
//# sourceMappingURL=text-bitmap.min.js.map
