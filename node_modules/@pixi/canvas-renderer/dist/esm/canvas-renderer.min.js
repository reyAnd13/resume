/*!
 * @pixi/canvas-renderer - v6.0.4
 * Compiled Tue, 11 May 2021 18:00:23 UTC
 *
 * @pixi/canvas-renderer is licensed under the MIT License.
 * http://www.opensource.org/licenses/mit-license
 */
import{RenderTexture as t,BaseRenderTexture as e,CanvasResource as o,AbstractRenderer as r,Renderer as i,BaseTexture as n,Texture as a}from"@pixi/core";import{CanvasRenderTarget as s,hex2string as h,rgb2hex as l,sayHello as c,hex2rgb as u}from"@pixi/utils";import{SHAPES as d,Matrix as p}from"@pixi/math";import{BLEND_MODES as g,SCALE_MODES as v,RENDERER_TYPE as f}from"@pixi/constants";import{settings as m}from"@pixi/settings";var C=function(t,e){return(C=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)e.hasOwnProperty(o)&&(t[o]=e[o])})(t,e)};var T=function(){function t(t){this.renderer=t,this._foundShapes=[]}return t.prototype.pushMask=function(t){var e=this.renderer,o=t.maskObject||t;e.context.save();var r=this._foundShapes;if(this.recursiveFindShapes(o,r),r.length>0){var i=e.context;i.beginPath();for(var n=0;n<r.length;n++){var a=r[n],s=a.transform.worldTransform;this.renderer.setContextTransform(s),this.renderGraphicsShape(a)}r.length=0,i.clip()}},t.prototype.recursiveFindShapes=function(t,e){t.geometry&&t.geometry.graphicsData&&e.push(t);var o=t.children;if(o)for(var r=0;r<o.length;r++)this.recursiveFindShapes(o[r],e)},t.prototype.renderGraphicsShape=function(t){t.finishPoly();var e=this.renderer.context,o=t.geometry.graphicsData,r=o.length;if(0!==r)for(var i=0;i<r;i++){var n=o[i].shape;if(n.type===d.POLY){var a=n.points;e.moveTo(a[0],a[1]);for(var s=1;s<a.length/2;s++)e.lineTo(a[2*s],a[2*s+1]);a[0]===a[a.length-2]&&a[1]===a[a.length-1]&&e.closePath()}else if(n.type===d.RECT)e.rect(n.x,n.y,n.width,n.height),e.closePath();else if(n.type===d.CIRC)e.arc(n.x,n.y,n.radius,0,2*Math.PI),e.closePath();else if(n.type===d.ELIP){var h=2*n.width,l=2*n.height,c=n.x-h/2,u=n.y-l/2,p=h/2*.5522848,g=l/2*.5522848,v=c+h,f=u+l,m=c+h/2,C=u+l/2;e.moveTo(c,C),e.bezierCurveTo(c,C-g,m-p,u,m,u),e.bezierCurveTo(m+p,u,v,C-g,v,C),e.bezierCurveTo(v,C+g,m+p,f,m,f),e.bezierCurveTo(m-p,f,c,C+g,c,C),e.closePath()}else if(n.type===d.RREC){var T=n.x,y=n.y,x=n.width,_=n.height,b=n.radius,S=Math.min(x,_)/2|0;b=b>S?S:b,e.moveTo(T,y+b),e.lineTo(T,y+_-b),e.quadraticCurveTo(T,y+_,T+b,y+_),e.lineTo(T+x-b,y+_),e.quadraticCurveTo(T+x,y+_,T+x,y+_-b),e.lineTo(T+x,y+b),e.quadraticCurveTo(T+x,y,T+x-b,y),e.lineTo(T+b,y),e.quadraticCurveTo(T,y,T,y+b),e.closePath()}}},t.prototype.popMask=function(t){t.context.restore(),t.invalidateBlendMode()},t.prototype.destroy=function(){},t}();function y(t){var e=document.createElement("canvas");e.width=6,e.height=1;var o=e.getContext("2d");return o.fillStyle=t,o.fillRect(0,0,6,1),e}function x(){if("undefined"==typeof document)return!1;var t=y("#ff00ff"),e=y("#ffff00"),o=document.createElement("canvas");o.width=6,o.height=1;var r=o.getContext("2d");r.globalCompositeOperation="multiply",r.drawImage(t,0,0),r.drawImage(e,2,0);var i=r.getImageData(2,0,1,1);if(!i)return!1;var n=i.data;return 255===n[0]&&0===n[1]&&0===n[2]}var _=new p,b=function(r){function i(t){var e,o=r.call(this,f.CANVAS,t)||this;if(o.rootContext=o.view.getContext("2d",{alpha:o.useContextAlpha}),o.context=o.rootContext,o.refresh=!0,o.maskManager=new T(o),o.smoothProperty="imageSmoothingEnabled",!o.rootContext.imageSmoothingEnabled){var n=o.rootContext;n.webkitImageSmoothingEnabled?o.smoothProperty="webkitImageSmoothingEnabled":n.mozImageSmoothingEnabled?o.smoothProperty="mozImageSmoothingEnabled":n.oImageSmoothingEnabled?o.smoothProperty="oImageSmoothingEnabled":n.msImageSmoothingEnabled&&(o.smoothProperty="msImageSmoothingEnabled")}return o.initPlugins(i.__plugins),o.blendModes=(void 0===e&&(e=[]),x()?(e[g.NORMAL]="source-over",e[g.ADD]="lighter",e[g.MULTIPLY]="multiply",e[g.SCREEN]="screen",e[g.OVERLAY]="overlay",e[g.DARKEN]="darken",e[g.LIGHTEN]="lighten",e[g.COLOR_DODGE]="color-dodge",e[g.COLOR_BURN]="color-burn",e[g.HARD_LIGHT]="hard-light",e[g.SOFT_LIGHT]="soft-light",e[g.DIFFERENCE]="difference",e[g.EXCLUSION]="exclusion",e[g.HUE]="hue",e[g.SATURATION]="saturate",e[g.COLOR]="color",e[g.LUMINOSITY]="luminosity"):(e[g.NORMAL]="source-over",e[g.ADD]="lighter",e[g.MULTIPLY]="source-over",e[g.SCREEN]="source-over",e[g.OVERLAY]="source-over",e[g.DARKEN]="source-over",e[g.LIGHTEN]="source-over",e[g.COLOR_DODGE]="source-over",e[g.COLOR_BURN]="source-over",e[g.HARD_LIGHT]="source-over",e[g.SOFT_LIGHT]="source-over",e[g.DIFFERENCE]="source-over",e[g.EXCLUSION]="source-over",e[g.HUE]="source-over",e[g.SATURATION]="source-over",e[g.COLOR]="source-over",e[g.LUMINOSITY]="source-over"),e[g.NORMAL_NPM]=e[g.NORMAL],e[g.ADD_NPM]=e[g.ADD],e[g.SCREEN_NPM]=e[g.SCREEN],e[g.SRC_IN]="source-in",e[g.SRC_OUT]="source-out",e[g.SRC_ATOP]="source-atop",e[g.DST_OVER]="destination-over",e[g.DST_IN]="destination-in",e[g.DST_OUT]="destination-out",e[g.DST_ATOP]="destination-atop",e[g.XOR]="xor",e[g.SUBTRACT]="source-over",e),o._activeBlendMode=null,o._outerBlend=!1,o._projTransform=null,o.renderingToScreen=!1,c("Canvas"),o.resize(o.options.width,o.options.height),o}return function(t,e){function o(){this.constructor=t}C(t,e),t.prototype=null===e?Object.create(e):(o.prototype=e.prototype,new o)}(i,r),i.prototype.render=function(r,i){if(this.view){var n,a,c,u;i&&(i instanceof t||i instanceof e?(n=i,a=arguments[2],c=arguments[3],u=arguments[4]):(n=i.renderTexture,a=i.clear,c=i.transform,u=i.skipUpdateTransform)),this.renderingToScreen=!n,this.emit("prerender");var d=this.resolution;n?((n=n.castToBaseTexture())._canvasRenderTarget||(n._canvasRenderTarget=new s(n.width,n.height,n.resolution),n.resource=new o(n._canvasRenderTarget.canvas),n.valid=!0),this.context=n._canvasRenderTarget.context,this.resolution=n._canvasRenderTarget.resolution):this.context=this.rootContext;var p=this.context;if(this._projTransform=c||null,n||(this._lastObjectRendered=r),!u){var v=r.enableTempParent();r.updateTransform(),r.disableTempParent(v)}if(p.save(),p.setTransform(1,0,0,1,0,0),p.globalAlpha=1,this._activeBlendMode=g.NORMAL,this._outerBlend=!1,p.globalCompositeOperation=this.blendModes[g.NORMAL],void 0!==a?a:this.clearBeforeRender)if(this.renderingToScreen)p.clearRect(0,0,this.width,this.height),this.backgroundAlpha>0&&(p.globalAlpha=this.useContextAlpha?this.backgroundAlpha:1,p.fillStyle=this._backgroundColorString,p.fillRect(0,0,this.width,this.height),p.globalAlpha=1);else{(n=n)._canvasRenderTarget.clear();var f=n.clearColor;f[3]>0&&(p.globalAlpha=this.useContextAlpha?f[3]:1,p.fillStyle=h(l(f)),p.fillRect(0,0,n.realWidth,n.realHeight),p.globalAlpha=1)}var m=this.context;this.context=p,r.renderCanvas(this),this.context=m,p.restore(),this.resolution=d,this._projTransform=null,this.emit("postrender")}},i.prototype.setContextTransform=function(t,e,o){var r=t,i=this._projTransform,n=this.resolution;o=o||n,i&&((r=_).copyFrom(t),r.prepend(i)),e?this.context.setTransform(r.a*o,r.b*o,r.c*o,r.d*o,r.tx*n|0,r.ty*n|0):this.context.setTransform(r.a*o,r.b*o,r.c*o,r.d*o,r.tx*n,r.ty*n)},i.prototype.clear=function(t,e){void 0===t&&(t=this._backgroundColorString),void 0===e&&(e=this.backgroundAlpha);var o=this.context;o.clearRect(0,0,this.width,this.height),t&&(o.globalAlpha=this.useContextAlpha?e:1,o.fillStyle=t,o.fillRect(0,0,this.width,this.height),o.globalAlpha=1)},i.prototype.setBlendMode=function(t,e){var o=t===g.SRC_IN||t===g.SRC_OUT||t===g.DST_IN||t===g.DST_ATOP;!e&&o&&(t=g.NORMAL),this._activeBlendMode!==t&&(this._activeBlendMode=t,this._outerBlend=o,this.context.globalCompositeOperation=this.blendModes[t])},i.prototype.destroy=function(t){r.prototype.destroy.call(this,t),this.context=null,this.refresh=!0,this.maskManager.destroy(),this.maskManager=null,this.smoothProperty=null},i.prototype.resize=function(t,e){r.prototype.resize.call(this,t,e),this.smoothProperty&&(this.rootContext[this.smoothProperty]=m.SCALE_MODE===v.LINEAR)},i.prototype.invalidateBlendMode=function(){this._activeBlendMode=this.blendModes.indexOf(this.context.globalCompositeOperation)},i.registerPlugin=function(t,e){i.__plugins=i.__plugins||{},i.__plugins[t]=e},i}(r),S={canvas:null,getTintedCanvas:function(t,e){var o=t.texture,r="#"+("00000"+(0|(e=S.roundColor(e))).toString(16)).substr(-6);o.tintCache=o.tintCache||{};var i,n=o.tintCache[r];if(n){if(n.tintId===o._updateID)return o.tintCache[r];i=o.tintCache[r]}else i=document.createElement("canvas");if(S.tintMethod(o,e,i),i.tintId=o._updateID,S.convertTintToImage){var a=new Image;a.src=i.toDataURL(),o.tintCache[r]=a}else o.tintCache[r]=i;return i},getTintedPattern:function(t,e){var o="#"+("00000"+(0|(e=S.roundColor(e))).toString(16)).substr(-6);t.patternCache=t.patternCache||{};var r=t.patternCache[o];return r&&r.tintId===t._updateID?r:(S.canvas||(S.canvas=document.createElement("canvas")),S.tintMethod(t,e,S.canvas),(r=S.canvas.getContext("2d").createPattern(S.canvas,"repeat")).tintId=t._updateID,t.patternCache[o]=r,r)},tintWithMultiply:function(t,e,o){var r=o.getContext("2d"),i=t._frame.clone(),n=t.baseTexture.resolution;i.x*=n,i.y*=n,i.width*=n,i.height*=n,o.width=Math.ceil(i.width),o.height=Math.ceil(i.height),r.save(),r.fillStyle="#"+("00000"+(0|e).toString(16)).substr(-6),r.fillRect(0,0,i.width,i.height),r.globalCompositeOperation="multiply";var a=t.baseTexture.getDrawableSource();r.drawImage(a,i.x,i.y,i.width,i.height,0,0,i.width,i.height),r.globalCompositeOperation="destination-atop",r.drawImage(a,i.x,i.y,i.width,i.height,0,0,i.width,i.height),r.restore()},tintWithOverlay:function(t,e,o){var r=o.getContext("2d"),i=t._frame.clone(),n=t.baseTexture.resolution;i.x*=n,i.y*=n,i.width*=n,i.height*=n,o.width=Math.ceil(i.width),o.height=Math.ceil(i.height),r.save(),r.globalCompositeOperation="copy",r.fillStyle="#"+("00000"+(0|e).toString(16)).substr(-6),r.fillRect(0,0,i.width,i.height),r.globalCompositeOperation="destination-atop",r.drawImage(t.baseTexture.getDrawableSource(),i.x,i.y,i.width,i.height,0,0,i.width,i.height),r.restore()},tintWithPerPixel:function(t,e,o){var r=o.getContext("2d"),i=t._frame.clone(),n=t.baseTexture.resolution;i.x*=n,i.y*=n,i.width*=n,i.height*=n,o.width=Math.ceil(i.width),o.height=Math.ceil(i.height),r.save(),r.globalCompositeOperation="copy",r.drawImage(t.baseTexture.getDrawableSource(),i.x,i.y,i.width,i.height,0,0,i.width,i.height),r.restore();for(var a=u(e),s=a[0],h=a[1],l=a[2],c=r.getImageData(0,0,i.width,i.height),d=c.data,p=0;p<d.length;p+=4)d[p+0]*=s,d[p+1]*=h,d[p+2]*=l;r.putImageData(c,0,0)},roundColor:function(t){var e=S.cacheStepsPerColorChannel,o=u(t);return o[0]=Math.min(255,o[0]/e*e),o[1]=Math.min(255,o[1]/e*e),o[2]=Math.min(255,o[2]/e*e),l(o)},cacheStepsPerColorChannel:8,convertTintToImage:!1,canUseMultiply:x(),tintMethod:null};S.tintMethod=S.canUseMultiply?S.tintWithMultiply:S.tintWithPerPixel;var R=i.create;i.create=function(t){if(!(t&&t.forceCanvas))try{return R(t)}catch(t){}return new b(t)},n.prototype.getDrawableSource=function(){var t=this.resource;return t?t.bitmap||t.source:null},e.prototype._canvasRenderTarget=null,a.prototype.patternCache=null,a.prototype.tintCache=null;export{b as CanvasRenderer,x as canUseNewCanvasBlendModes,S as canvasUtils};
//# sourceMappingURL=canvas-renderer.min.js.map
