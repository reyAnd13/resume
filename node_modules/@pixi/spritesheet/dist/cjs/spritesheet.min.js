/*!
 * @pixi/spritesheet - v6.0.4
 * Compiled Tue, 11 May 2021 18:00:23 UTC
 *
 * @pixi/spritesheet is licensed under the MIT License.
 * http://www.opensource.org/licenses/mit-license
 */
"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var math=require("@pixi/math"),core=require("@pixi/core"),utils=require("@pixi/utils"),loaders=require("@pixi/loaders"),Spritesheet=function(){function e(e,t,r){void 0===r&&(r=null),this._texture=e instanceof core.Texture?e:null,this.baseTexture=e instanceof core.BaseTexture?e:this._texture.baseTexture,this.textures={},this.animations={},this.data=t;var s=this.baseTexture.resource;this.resolution=this._updateResolution(r||(s?s.url:null)),this._frames=this.data.frames,this._frameKeys=Object.keys(this._frames),this._batchIndex=0,this._callback=null}return e.prototype._updateResolution=function(e){void 0===e&&(e=null);var t=this.data.meta.scale,r=utils.getResolutionOfUrl(e,null);return null===r&&(r=void 0!==t?parseFloat(t):1),1!==r&&this.baseTexture.setResolution(r),r},e.prototype.parse=function(t){this._batchIndex=0,this._callback=t,this._frameKeys.length<=e.BATCH_SIZE?(this._processFrames(0),this._processAnimations(),this._parseComplete()):this._nextBatch()},e.prototype._processFrames=function(t){for(var r=t,s=e.BATCH_SIZE;r-t<s&&r<this._frameKeys.length;){var i=this._frameKeys[r],o=this._frames[i],a=o.frame;if(a){var n=null,u=null,l=!1!==o.trimmed&&o.sourceSize?o.sourceSize:o.frame,h=new math.Rectangle(0,0,Math.floor(l.w)/this.resolution,Math.floor(l.h)/this.resolution);n=o.rotated?new math.Rectangle(Math.floor(a.x)/this.resolution,Math.floor(a.y)/this.resolution,Math.floor(a.h)/this.resolution,Math.floor(a.w)/this.resolution):new math.Rectangle(Math.floor(a.x)/this.resolution,Math.floor(a.y)/this.resolution,Math.floor(a.w)/this.resolution,Math.floor(a.h)/this.resolution),!1!==o.trimmed&&o.spriteSourceSize&&(u=new math.Rectangle(Math.floor(o.spriteSourceSize.x)/this.resolution,Math.floor(o.spriteSourceSize.y)/this.resolution,Math.floor(a.w)/this.resolution,Math.floor(a.h)/this.resolution)),this.textures[i]=new core.Texture(this.baseTexture,n,h,u,o.rotated?2:0,o.anchor),core.Texture.addToCache(this.textures[i],i)}r++}},e.prototype._processAnimations=function(){var e=this.data.animations||{};for(var t in e){this.animations[t]=[];for(var r=0;r<e[t].length;r++){var s=e[t][r];this.animations[t].push(this.textures[s])}}},e.prototype._parseComplete=function(){var e=this._callback;this._callback=null,this._batchIndex=0,e.call(this,this.textures)},e.prototype._nextBatch=function(){var t=this;this._processFrames(this._batchIndex*e.BATCH_SIZE),this._batchIndex++,setTimeout(function(){t._batchIndex*e.BATCH_SIZE<t._frameKeys.length?t._nextBatch():(t._processAnimations(),t._parseComplete())},0)},e.prototype.destroy=function(e){var t;for(var r in void 0===e&&(e=!1),this.textures)this.textures[r].destroy();this._frames=null,this._frameKeys=null,this.data=null,this.textures=null,e&&(null===(t=this._texture)||void 0===t||t.destroy(),this.baseTexture.destroy()),this._texture=null,this.baseTexture=null},e.BATCH_SIZE=1e3,e}(),SpritesheetLoader=function(){function e(){}return e.use=function(t,r){var s,i,o=this,a=t.name+"_image";if(t.data&&t.type===loaders.LoaderResource.TYPE.JSON&&t.data.frames&&!o.resources[a]){var n=null===(i=null===(s=t.data)||void 0===s?void 0:s.meta)||void 0===i?void 0:i.related_multi_packs;if(Array.isArray(n))for(var u=function(e){if("string"!=typeof e)return"continue";var r=e.replace(".json",""),s=utils.url.resolve(t.url.replace(o.baseUrl,""),e);if(o.resources[r]||Object.values(o.resources).some(function(e){return utils.url.format(utils.url.parse(e.url))===s}))return"continue";var i={crossOrigin:t.crossOrigin,loadType:loaders.LoaderResource.LOAD_TYPE.XHR,xhrType:loaders.LoaderResource.XHR_RESPONSE_TYPE.JSON,parentResource:t};o.add(r,s,i)},l=0,h=n;l<h.length;l++){u(h[l])}var c={crossOrigin:t.crossOrigin,metadata:t.metadata.imageMetadata,parentResource:t},f=e.getResourcePath(t,o.baseUrl);o.add(a,f,c,function(e){if(e.error)r(e.error);else{var s=new Spritesheet(e.texture,t.data,t.url);s.parse(function(){t.spritesheet=s,t.textures=s.textures,r()})}})}else r()},e.getResourcePath=function(e,t){return e.isDataUrl?e.data.meta.image:utils.url.resolve(e.url.replace(t,""),e.data.meta.image)},e}();exports.Spritesheet=Spritesheet,exports.SpritesheetLoader=SpritesheetLoader;
//# sourceMappingURL=spritesheet.min.js.map
