/*!
 * @pixi/mixin-cache-as-bitmap - v6.0.4
 * Compiled Tue, 11 May 2021 18:00:23 UTC
 *
 * @pixi/mixin-cache-as-bitmap is licensed under the MIT License.
 * http://www.opensource.org/licenses/mit-license
 */
"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var core=require("@pixi/core"),sprite=require("@pixi/sprite"),display=require("@pixi/display"),math=require("@pixi/math"),utils=require("@pixi/utils"),settings=require("@pixi/settings"),_tempMatrix=new math.Matrix;display.DisplayObject.prototype._cacheAsBitmap=!1,display.DisplayObject.prototype._cacheData=null,display.DisplayObject.prototype._cacheAsBitmapResolution=null;var CacheData=function(){return function(){this.textureCacheId=null,this.originalRender=null,this.originalRenderCanvas=null,this.originalCalculateBounds=null,this.originalGetLocalBounds=null,this.originalUpdateTransform=null,this.originalDestroy=null,this.originalMask=null,this.originalFilterArea=null,this.originalContainsPoint=null,this.sprite=null}}();Object.defineProperties(display.DisplayObject.prototype,{cacheAsBitmapResolution:{get:function(){return this._cacheAsBitmapResolution},set:function(t){t!==this._cacheAsBitmapResolution&&(this._cacheAsBitmapResolution=t,this.cacheAsBitmap&&(this.cacheAsBitmap=!1,this.cacheAsBitmap=!0))}},cacheAsBitmap:{get:function(){return this._cacheAsBitmap},set:function(t){var a;this._cacheAsBitmap!==t&&(this._cacheAsBitmap=t,t?(this._cacheData||(this._cacheData=new CacheData),(a=this._cacheData).originalRender=this.render,a.originalRenderCanvas=this.renderCanvas,a.originalUpdateTransform=this.updateTransform,a.originalCalculateBounds=this.calculateBounds,a.originalGetLocalBounds=this.getLocalBounds,a.originalDestroy=this.destroy,a.originalContainsPoint=this.containsPoint,a.originalMask=this._mask,a.originalFilterArea=this.filterArea,this.render=this._renderCached,this.renderCanvas=this._renderCachedCanvas,this.destroy=this._cacheAsBitmapDestroy):((a=this._cacheData).sprite&&this._destroyCachedDisplayObject(),this.render=a.originalRender,this.renderCanvas=a.originalRenderCanvas,this.calculateBounds=a.originalCalculateBounds,this.getLocalBounds=a.originalGetLocalBounds,this.destroy=a.originalDestroy,this.updateTransform=a.originalUpdateTransform,this.containsPoint=a.originalContainsPoint,this._mask=a.originalMask,this.filterArea=a.originalFilterArea))}}}),display.DisplayObject.prototype._renderCached=function(t){!this.visible||this.worldAlpha<=0||!this.renderable||(this._initCachedDisplayObject(t),this._cacheData.sprite.transform._worldID=this.transform._worldID,this._cacheData.sprite.worldAlpha=this.worldAlpha,this._cacheData.sprite._render(t))},display.DisplayObject.prototype._initCachedDisplayObject=function(t){if(!this._cacheData||!this._cacheData.sprite){var a=this.alpha;this.alpha=1,t.batch.flush();var e=this.getLocalBounds(null,!0).clone();if(this.filters){var i=this.filters[0].padding;e.pad(i)}e.ceil(settings.settings.RESOLUTION);var s=t.renderTexture.current,r=t.renderTexture.sourceFrame.clone(),n=t.renderTexture.destinationFrame.clone(),h=t.projection.transform,o=core.RenderTexture.create({width:e.width,height:e.height,resolution:this.cacheAsBitmapResolution||t.resolution}),c="cacheAsBitmap_"+utils.uid();this._cacheData.textureCacheId=c,core.BaseTexture.addToCache(o.baseTexture,c),core.Texture.addToCache(o,c);var l=this.transform.localTransform.copyTo(_tempMatrix).invert().translate(-e.x,-e.y);this.render=this._cacheData.originalRender,t.render(this,{renderTexture:o,clear:!0,transform:l,skipUpdateTransform:!1}),t.projection.transform=h,t.renderTexture.bind(s,r,n),this.render=this._renderCached,this.updateTransform=this.displayObjectUpdateTransform,this.calculateBounds=this._calculateCachedBounds,this.getLocalBounds=this._getCachedLocalBounds,this._mask=null,this.filterArea=null,this.alpha=a;var d=new sprite.Sprite(o);d.transform.worldTransform=this.transform.worldTransform,d.anchor.x=-e.x/e.width,d.anchor.y=-e.y/e.height,d.alpha=a,d._bounds=this._bounds,this._cacheData.sprite=d,this.transform._parentID=-1,this.parent?this.updateTransform():(this.enableTempParent(),this.updateTransform(),this.disableTempParent(null)),this.containsPoint=d.containsPoint.bind(d)}},display.DisplayObject.prototype._renderCachedCanvas=function(t){!this.visible||this.worldAlpha<=0||!this.renderable||(this._initCachedDisplayObjectCanvas(t),this._cacheData.sprite.worldAlpha=this.worldAlpha,this._cacheData.sprite._renderCanvas(t))},display.DisplayObject.prototype._initCachedDisplayObjectCanvas=function(t){if(!this._cacheData||!this._cacheData.sprite){var a=this.getLocalBounds(null,!0),e=this.alpha;this.alpha=1;var i=t.context,s=t._projTransform;a.ceil(settings.settings.RESOLUTION);var r=core.RenderTexture.create({width:a.width,height:a.height}),n="cacheAsBitmap_"+utils.uid();this._cacheData.textureCacheId=n,core.BaseTexture.addToCache(r.baseTexture,n),core.Texture.addToCache(r,n);var h=_tempMatrix;this.transform.localTransform.copyTo(h),h.invert(),h.tx-=a.x,h.ty-=a.y,this.renderCanvas=this._cacheData.originalRenderCanvas,t.render(this,{renderTexture:r,clear:!0,transform:h,skipUpdateTransform:!1}),t.context=i,t._projTransform=s,this.renderCanvas=this._renderCachedCanvas,this.updateTransform=this.displayObjectUpdateTransform,this.calculateBounds=this._calculateCachedBounds,this.getLocalBounds=this._getCachedLocalBounds,this._mask=null,this.filterArea=null,this.alpha=e;var o=new sprite.Sprite(r);o.transform.worldTransform=this.transform.worldTransform,o.anchor.x=-a.x/a.width,o.anchor.y=-a.y/a.height,o.alpha=e,o._bounds=this._bounds,this._cacheData.sprite=o,this.transform._parentID=-1,this.parent?this.updateTransform():(this.parent=t._tempDisplayObjectParent,this.updateTransform(),this.parent=null),this.containsPoint=o.containsPoint.bind(o)}},display.DisplayObject.prototype._calculateCachedBounds=function(){this._bounds.clear(),this._cacheData.sprite.transform._worldID=this.transform._worldID,this._cacheData.sprite._calculateBounds(),this._bounds.updateID=this._boundsID},display.DisplayObject.prototype._getCachedLocalBounds=function(){return this._cacheData.sprite.getLocalBounds(null)},display.DisplayObject.prototype._destroyCachedDisplayObject=function(){this._cacheData.sprite._texture.destroy(!0),this._cacheData.sprite=null,core.BaseTexture.removeFromCache(this._cacheData.textureCacheId),core.Texture.removeFromCache(this._cacheData.textureCacheId),this._cacheData.textureCacheId=null},display.DisplayObject.prototype._cacheAsBitmapDestroy=function(t){this.cacheAsBitmap=!1,this.destroy(t)},exports.CacheData=CacheData;
//# sourceMappingURL=mixin-cache-as-bitmap.min.js.map
